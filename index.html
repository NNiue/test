<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>AI装修效果生成器</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px }
        .form-group { margin-bottom: 15px }
        label { display: block; margin-bottom: 5px }
        input, select, textarea { width: 100%; padding: 8px }
        #preview { max-width: 300px; margin: 10px 0 }
        #result { margin-top: 20px; display: grid; grid-gap: 10px }
        .loading { display: none; color: #666; margin: 10px 0 }
        .error { color: red; margin: 10px 0 }
        button {
            background: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer
        }
    </style>
</head>
<body>
    <h1>AI装修效果生成器</h1>

    <form id="generateForm">
        <div class="form-group">
            <label>上传参考图（必填）:</label>
            <input type="file" id="image" accept="image/*" required>
            <img id="preview" src="#" alt="预览" style="display:none">
        </div>

        <div class="form-group">
            <label>选择LoRA模型:</label>
            <select id="lora">
                <option value="1">现代简约风格</option>
                <option value="2">古典欧式风格</option>
            </select>
        </div>

        <div class="form-group">
            <label>描述词（建议格式）:</label>
            <textarea id="prompt" rows="3" required placeholder="示例：modern living room, natural lighting, minimalist furniture, beige color scheme, plants decoration"></textarea>
            <datalist id="presets">
                <option>modern living room, marble floor, floor-to-ceiling windows</option>
                <option>cozy bedroom, warm lighting, wooden furniture, textile textures</option>
            </datalist>
        </div>

        <div class="form-group">
            <label>生成数量:</label>
            <select id="num_images">
                <option>1</option>
                <option>2</option>
                <option>3</option>
                <option>4</option>
            </select>
        </div>

        <button type="submit">开始生成</button>
    </form>

    <div class="loading" id="loading">生成中...（可能需要30-60秒）</div>
    <div class="error" id="error"></div>
    <div id="result"></div>

    <script>
        const API_TOKEN = "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";

        // 图片预览
        document.getElementById('image').addEventListener('change',  function(e) {
            const preview = document.getElementById('preview');
            if (this.files[0])  {
                preview.style.display  = 'block';
                preview.src  = URL.createObjectURL(this.files[0]);
            }
        });

        // 提交处理
        document.getElementById('generateForm').addEventListener('submit',  async (e) => {
            e.preventDefault();
            document.getElementById('error').textContent  = '';
            document.getElementById('loading').style.display  = 'block';

            try {
                // 构建请求数据
                const formData = new FormData();
                formData.append('image',  document.getElementById('image').files[0]);
                formData.append('prompt',  document.getElementById('prompt').value);
                formData.append('parameters',  JSON.stringify({
                    num_inference_steps: 30,
                    num_images_per_prompt: parseInt(document.getElementById('num_images').value)
                }));

                // API请求
                const modelId = document.getElementById('lora').value;
                const response = await fetch(
                    `https://api-inference.huggingface.co/models/NNiuNUll/my-lora/${modelId}`,
                    {
                        headers: { Authorization: `Bearer ${API_TOKEN}` },
                        method: 'POST',
                        body: formData
                    }
                );

                // 处理响应
                if (!response.ok)  throw new Error(await response.text());
                const blob = await response.blob();

                // 显示结果
                const img = document.createElement('img');
                img.src  = URL.createObjectURL(blob);
                img.style.maxWidth  = '100%';
                document.getElementById('result').prepend(img);
            } catch (err) {
                document.getElementById('error').textContent  = `生成失败：${err.message}`;
            } finally {
                document.getElementById('loading').style.display  = 'none';
            }
        });
    </script>
</body>
</html>