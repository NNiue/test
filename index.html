<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>赛博朋克LoRA生成器</title>
    <style>
        :root {
            --primary-color: #00ff9d;
            --bg-color: #1a1a1a;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg-color);
            color: white;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            border: 2px solid var(--primary-color);
            padding: 25px;
            border-radius: 12px;
        }
        .input-group {
            margin: 20px 0;
        }
        label {
            display: block;
            margin-bottom: 8px;
            color: var(--primary-color);
        }
        select, input, textarea {
            width: 100%;
            padding: 12px;
            background: #333;
            border: 1px solid #444;
            color: white;
            border-radius: 6px;
            margin-top: 5px;
        }
        button {
            background: var(--primary-color);
            color: var(--bg-color);
            padding: 15px 30px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s;
        }
        button:hover {
            transform: scale(1.05);
        }
        #preview {
            max-width: 512px;
            border: 2px dashed #666;
            margin: 15px 0;
            border-radius: 8px;
        }
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(256px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        .result-img {
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 255, 157, 0.2);
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔮 赛博朋克生成实验室</h1>

        <!-- 核心控制模块 -->
        <div class="input-group">
            <label>🛠️ 选择模型版本：</label>
            <select id="modelSelect">
                <option value="v1">Cyberpunk X1 (基础版)</option>
                <option value="v2">Neon Night v2.0 (增强版)</option>
            </select>
        </div>

        <div class="input-group">
            <label>🌌 上传参考图像：</label>
            <input type="file" id="imageInput" accept="image/png, image/jpeg">
            <img id="preview">
        </div>

        <div class="input-group">
            <label>🔢 生成数量 (1-4)：</label>
            <input type="number" id="numInput" min="1" max="4" value="2">
        </div>

        <div class="input-group">
            <label>📝 文字描述：</label>
            <textarea id="prompt" rows="3" placeholder="例：未来城市雨夜，霓虹全息广告，飞行汽车穿梭在高楼之间"></textarea>
        </div>

        <button onclick="generate()">✨ 开始生成</button>
        <div id="status" style="margin:15px 0; color:#00ff9d;"></div>
        <div class="grid" id="results"></div>
    </div>

    <script>
        const API_TOKEN = "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";
        const API_ENDPOINT = "https://api-inference.huggingface.co/models/NNiuNUll/my-lora";

        // 图像预览功能
        document.getElementById('imageInput').addEventListener('change',  function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload  = function(e) {
                const preview = document.getElementById('preview');
                preview.src  = e.target.result;
                preview.style.display  = 'block';
            };
            reader.readAsDataURL(file);
        });

        async function generate() {
            const btn = document.querySelector('button');
            btn.disabled  = true;
            document.getElementById('status').textContent  = "🔮 正在构建未来世界...";

            try {
                // 输入验证
                const file = document.getElementById('imageInput').files[0];
                if (!file) throw new Error("请上传参考图像");
                if (file.size  > 5 * 1024 * 1024) throw new Error("图像大小超过5MB限制");

                // 构建多部分请求
                const formData = new FormData();
                formData.append('image',  file);
                formData.append('prompt',  document.getElementById('prompt').value);
                formData.append('parameters',  JSON.stringify({
                    num_images: parseInt(document.getElementById('numInput').value),
                    lora_scale: document.getElementById('modelSelect').value  === 'v1' ? 0.7 : 0.8,
                    guidance_scale: 8.5
                }));

                // 发送请求
                const response = await fetch(API_ENDPOINT, {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_TOKEN}`,
                        "X-Wait-For-Model": "120"  // 等待模型加载120秒
                    },
                    body: formData
                });

                // 处理响应
                if (!response.ok)  {
                    const errorData = await response.json();
                    throw new Error(`API错误: ${errorData.error  || '未知错误'}`);
                }

                // 展示结果
                const result = await response.blob();
                const imgURL = URL.createObjectURL(result);
                const imgElement = document.createElement('img');
                imgElement.src  = imgURL;
                imgElement.className  = 'result-img';
                document.getElementById('results').prepend(imgElement);

                document.getElementById('status').textContent  = "✅ 生成成功！";

            } catch (error) {
                document.getElementById('status').textContent  = `❌ 错误: ${error.message}`;
                console.error("[DEBUG]",  error);
            } finally {
                btn.disabled  = false;
            }
        }
    </script>
</body>
</html>